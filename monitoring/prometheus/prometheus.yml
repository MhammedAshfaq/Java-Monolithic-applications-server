# ===========================================
# Prometheus Configuration
# ===========================================
# Scrapes Spring Boot Actuator metrics from /actuator/prometheus.
#
# Reload config without restart:
#   curl -X POST http://localhost:9090/-/reload
#
# Useful PromQL queries:
#   - Request rate:          rate(http_server_requests_seconds_count[5m])
#   - P95 latency:          histogram_quantile(0.95, rate(http_server_requests_seconds_bucket[5m]))
#   - JVM heap used:        jvm_memory_used_bytes{area="heap"}
#   - DB pool active:       hikaricp_connections_active
#   - Error rate (5xx):     rate(http_server_requests_seconds_count{status=~"5.."}[5m])
# ===========================================

global:
  # How often Prometheus scrapes targets (15s is the recommended default)
  scrape_interval: 15s
  # How often rules are evaluated (alerting/recording rules)
  evaluation_interval: 15s
  # Timeout for scrape requests
  scrape_timeout: 10s

# Scrape configurations
scrape_configs:
  # ---- Spring Boot Application ----
  # Scrapes Micrometer metrics from /actuator/prometheus
  - job_name: 'spring-boot-app'
    metrics_path: '/actuator/prometheus'
    scrape_interval: 15s
    static_configs:
      # When running in Docker: use container name
      - targets: ['spring-app:8082']
        labels:
          application: 'spring-monolith-template'
          environment: 'docker'
    # Also scrape localhost when running app outside Docker
    # Uncomment below if running Java locally + Prometheus in Docker:
    # - targets: ['host.docker.internal:8082']
    #   labels:
    #     application: 'spring-monolith-template'
    #     environment: 'local'

  # ---- Prometheus self-monitoring ----
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
